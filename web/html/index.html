<!DOCTYPE html>
<html lang="en">
    <head>
       <script type="text/javascript" src="{{static_url("js/jquery-2.2.0.min.js")}}"></script>
       <meta charset="utf-8">
       <meta http-equiv="X-UA-Compatible" content="IE=edge">
       <meta name="viewport" content="width=device-width, initial-scale=1">
       <meta name="description" content="">
       <meta name="author" content="">

       <title>snaprate</title>

       <link href="{{static_url("vendor/bootstrap-3.3.6/dist/css/bootstrap.min.css")}}" rel="stylesheet">
       <link href="{{static_url("css/jumbotron.css")}}" rel="stylesheet">

    </head>
    <body>
        {{rate_subjects}} <hr>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="{{static_url("vendor/bootstrap-3.3.6/dist/js/bootstrap.min.js")}}"></script>
    <script>

    visible_subject = 1;
    visible_image = 1;
    n_subjects = {{n_subjects}};
    n_snapshots = {{n_snapshots}};

    $("img.subject1#image1").show();

    function validate(){
      ans = $('input').val();
      i = ['', '123', '321', '312', '132', '213', '231'].indexOf(ans);
      console.log(i);
      if (i == -1){
         alert('Value not allowed. Please correct.')
         return ;
      }
    }

    function hide_and_show(visible_class, visible_subject, visible_image){
      $("img."+visible_class).hide();
      visible_class = 'subject' + visible_subject;
      visible_image = 1;
      $("img."+visible_class+"#image1").show();
      $("span#subject_number").text(visible_subject);
      $("span#image_number").text(visible_image);

    }

    $("a").click(function(e){
      e.preventDefault();
      id = $(this).attr('id');

      if (id == "prevsubj") {
        validate();
        save_subject("prev");

        visible_class = 'subject' + visible_subject;
        if (visible_subject == 1) {
          visible_subject = n_subjects;
        }
        else {
          visible_subject = visible_subject - 1;
        }

        hide_and_show(visible_class, visible_subject, visible_image)
      }
      else if (id == "nextsubj"){
        validate();
        save_subject("next");

        visible_class = 'subject' + visible_subject;
        if (visible_subject == n_subjects) {
          visible_subject = 1;
        }
        else {
          visible_subject = visible_subject + 1;
        }

        hide_and_show(visible_class, visible_subject, visible_image)
      }

      else if (id == "prevsnap" || id == "nextsnap"){
        visible_class = 'subject' + visible_subject;
        visible_id = 'image' + visible_image;

        if ($("img." + visible_class + "#" + visible_id).is(":visible")) {
          if (id == "prevsnap") {
            if (visible_image == 1) {
              visible_image = n_snapshots;
            }
            else {
              visible_image = visible_image - 1;
            }
          }
          else if (id == "nextsnap"){
            if (visible_image == n_snapshots) {
              visible_image = 1;
            }
            else {
              visible_image = visible_image + 1;
            }
          }

          $("img." + visible_class + "#" + visible_id).hide();
          visible_id = 'image' + visible_image;
          $("img." + visible_class + "#" + visible_id).show();
        }
        $("span#image_number").text(visible_image);
      }
      return false;
    });

    function save_subject(then){
      $.ajax({
            type: "POST",
            url: "/post/",
            data: {"rankings":$('input').val(),
                   "subject":visible_subject,
                   "then":then},
            dataType:'json',
            success: function(data) {
                if ($('input').val() == ''){
                    $( "span.skipped" ).fadeIn( 150 ).delay( 100 ).fadeOut( 300 );
                }
                else {
                  $( "span.success" ).fadeIn( 150 ).delay( 100 ).fadeOut( 300 );
                }
                $('input').val(data[0]);
                $('#username').text(data[1]);
                return data;

            }
        });
    }
    $('a#logout').unbind('click')
    $("span").click(save_subject);

    </script>
  </body>
</html>
